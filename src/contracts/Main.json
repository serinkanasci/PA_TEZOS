{ parameter
    (or (or (or (or (address %banAdmin) (address %banAgent))
                (or (address %createAdmin)
                    (pair %createAgent (string %agency) (address %public_key))))
            (or (or (pair %createUser (int %id) (address %public_key)) (unit %deposit))
                (or (pair %mint
                       (pair %nftToMint (string %address_uri) (address %owner))
                       (nat %nftToMintId))
                    (int %payValidation))))
        (or (or (pair %transfer (address %destination) (nat %nftToTransfer))
                (pair %validationFinancingPlan
                   (int %id)
                   (pair %validation
                      (pair (pair (bool %active) (string %agency))
                            (mutez %contribution)
                            (int %mensualities_months))
                      (mutez %mensualities_price)
                      (nat %nftId))))
            (mutez %withdraw))) ;
  storage
    (pair (pair (pair (map %balances address mutez) (address %main_admin))
                (map %mapping_admin address bool)
                (map %mapping_agent address (pair (string %agency) (bool %is_ban))))
          (pair (map %mapping_user
                   int
                   (pair (address %public_key)
                         (pair %validation
                            (pair (pair (bool %active) (string %agency))
                                  (mutez %contribution)
                                  (int %mensualities_months))
                            (mutez %mensualities_price)
                            (nat %nftId))))
                (map %nfts nat (pair (string %address_uri) (address %owner))))
          (mutez %usable_fund)) ;
  code { LAMBDA address bool { SENDER ; COMPARE ; EQ } ;
         SWAP ;
         UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { DUP 2 ;
                         CAR ;
                         CAR ;
                         CDR ;
                         DIG 3 ;
                         SWAP ;
                         EXEC ;
                         IF { DUP 2 ;
                              CAR ;
                              CDR ;
                              CAR ;
                              DUP 2 ;
                              GET ;
                              IF_NONE
                                { DROP ; UNIT ; SWAP }
                                { DROP ;
                                  UNIT ;
                                  DUP 3 ;
                                  CDR ;
                                  DUP 4 ;
                                  CAR ;
                                  CDR ;
                                  CDR ;
                                  DUP 5 ;
                                  CAR ;
                                  CDR ;
                                  CAR ;
                                  PUSH bool True ;
                                  DIG 5 ;
                                  SWAP ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE ;
                                  PAIR ;
                                  DIG 3 ;
                                  CAR ;
                                  CAR ;
                                  PAIR ;
                                  PAIR } }
                            { DROP ; PUSH string "You are not admin" ; FAILWITH } ;
                         SWAP ;
                         DROP }
                       { DUP 2 ;
                         CAR ;
                         CAR ;
                         CDR ;
                         DIG 3 ;
                         SWAP ;
                         EXEC ;
                         IF { DUP 2 ;
                              CAR ;
                              CDR ;
                              CDR ;
                              DUP 2 ;
                              GET ;
                              IF_NONE
                                { DROP ; UNIT ; SWAP }
                                { UNIT ;
                                  DUP 4 ;
                                  CDR ;
                                  DUP 5 ;
                                  CAR ;
                                  CDR ;
                                  CDR ;
                                  PUSH bool True ;
                                  DIG 4 ;
                                  CAR ;
                                  PAIR ;
                                  DIG 4 ;
                                  SWAP ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE ;
                                  DUP 4 ;
                                  CAR ;
                                  CDR ;
                                  CAR ;
                                  PAIR ;
                                  DIG 3 ;
                                  CAR ;
                                  CAR ;
                                  PAIR ;
                                  PAIR } }
                            { DROP ; PUSH string "You are not admin" ; FAILWITH } ;
                         SWAP ;
                         DROP } }
                   { IF_LEFT
                       { DUP 2 ;
                         CAR ;
                         CAR ;
                         CDR ;
                         DIG 3 ;
                         SWAP ;
                         EXEC ;
                         IF { DUP 2 ;
                              CAR ;
                              CDR ;
                              CAR ;
                              DUP 2 ;
                              GET ;
                              IF_NONE
                                { UNIT ;
                                  DUP 3 ;
                                  CDR ;
                                  DUP 4 ;
                                  CAR ;
                                  CDR ;
                                  CDR ;
                                  DUP 5 ;
                                  CAR ;
                                  CDR ;
                                  CAR ;
                                  PUSH bool False ;
                                  DIG 5 ;
                                  SWAP ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE ;
                                  PAIR ;
                                  DIG 3 ;
                                  CAR ;
                                  CAR ;
                                  PAIR ;
                                  PAIR }
                                { DROP 2 ; UNIT ; SWAP } }
                            { DROP ; PUSH string "You are not admin" ; FAILWITH } ;
                         SWAP ;
                         DROP }
                       { DIG 2 ;
                         DROP ;
                         DUP ;
                         CDR ;
                         DUP 3 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         DUP 2 ;
                         GET ;
                         IF_NONE
                           { UNIT ;
                             DUP 4 ;
                             CDR ;
                             DUP 5 ;
                             CAR ;
                             CDR ;
                             CDR ;
                             PUSH bool False ;
                             DIG 5 ;
                             CAR ;
                             PAIR ;
                             DIG 4 ;
                             SWAP ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             DUP 4 ;
                             CAR ;
                             CDR ;
                             CAR ;
                             PAIR ;
                             DIG 3 ;
                             CAR ;
                             CAR ;
                             PAIR ;
                             PAIR }
                           { DROP 3 ; UNIT ; SWAP } ;
                         SWAP ;
                         DROP } } }
               { IF_LEFT
                   { IF_LEFT
                       { DIG 2 ;
                         DROP ;
                         DUP ;
                         CAR ;
                         DUP 3 ;
                         CDR ;
                         CAR ;
                         CAR ;
                         DUP 2 ;
                         GET ;
                         IF_NONE
                           { UNIT ;
                             DUP 4 ;
                             CDR ;
                             CDR ;
                             DUP 5 ;
                             CDR ;
                             CAR ;
                             CDR ;
                             DUP 6 ;
                             CDR ;
                             CAR ;
                             CAR ;
                             PUSH nat 1 ;
                             PUSH mutez 0 ;
                             PAIR ;
                             PUSH int 0 ;
                             PUSH mutez 0 ;
                             PAIR ;
                             PUSH string "" ;
                             PUSH bool False ;
                             PAIR ;
                             PAIR ;
                             PAIR ;
                             DIG 6 ;
                             CDR ;
                             PAIR ;
                             DIG 5 ;
                             SWAP ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             PAIR ;
                             PAIR ;
                             DIG 2 ;
                             CAR ;
                             PAIR }
                           { DROP 3 ; UNIT ; SWAP } ;
                         SWAP ;
                         DROP }
                       { DROP ;
                         DUP ;
                         CAR ;
                         CAR ;
                         CDR ;
                         DIG 2 ;
                         SWAP ;
                         EXEC ;
                         IF { AMOUNT ; DUP 2 ; CDR ; CDR ; ADD ; DUP 2 ; CDR ; CAR ; PAIR ; SWAP ; CAR }
                            { DUP ;
                              CAR ;
                              CAR ;
                              CAR ;
                              SENDER ;
                              GET ;
                              IF_NONE
                                { DUP ;
                                  CDR ;
                                  DUP 2 ;
                                  CAR ;
                                  CDR ;
                                  DUP 3 ;
                                  CAR ;
                                  CAR ;
                                  CDR ;
                                  DIG 3 ;
                                  CAR ;
                                  CAR ;
                                  CAR ;
                                  AMOUNT ;
                                  SENDER ;
                                  SWAP ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE }
                                { DUP 2 ;
                                  CDR ;
                                  DUP 3 ;
                                  CAR ;
                                  CDR ;
                                  DUP 4 ;
                                  CAR ;
                                  CAR ;
                                  CDR ;
                                  DIG 4 ;
                                  CAR ;
                                  CAR ;
                                  CAR ;
                                  AMOUNT ;
                                  DIG 5 ;
                                  ADD ;
                                  SENDER ;
                                  SWAP ;
                                  SOME ;
                                  SWAP ;
                                  UPDATE } ;
                              PAIR ;
                              PAIR } ;
                         PAIR } }
                   { IF_LEFT
                       { DIG 2 ;
                         DROP ;
                         DUP 2 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         SENDER ;
                         GET ;
                         IF_NONE
                           { DROP ; UNIT ; SWAP }
                           { PUSH bool False ;
                             SWAP ;
                             CDR ;
                             COMPARE ;
                             EQ ;
                             IF { DUP 2 ;
                                  CDR ;
                                  CAR ;
                                  CDR ;
                                  DUP 2 ;
                                  CDR ;
                                  GET ;
                                  IF_NONE
                                    { UNIT ;
                                      DUP 3 ;
                                      CDR ;
                                      CDR ;
                                      DUP 4 ;
                                      CDR ;
                                      CAR ;
                                      CDR ;
                                      DUP 4 ;
                                      CAR ;
                                      DIG 4 ;
                                      CDR ;
                                      SWAP ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      DUP 4 ;
                                      CDR ;
                                      CAR ;
                                      CAR ;
                                      PAIR ;
                                      PAIR ;
                                      DIG 2 ;
                                      CAR ;
                                      PAIR }
                                    { DROP 2 ; UNIT ; SWAP } }
                                { DROP ; UNIT ; SWAP } } ;
                         SWAP ;
                         DROP }
                       { DUP 2 ;
                         CAR ;
                         CAR ;
                         CDR ;
                         DIG 3 ;
                         SWAP ;
                         EXEC ;
                         IF { DUP 2 ;
                              CDR ;
                              CAR ;
                              CAR ;
                              DUP 2 ;
                              GET ;
                              IF_NONE
                                { DROP }
                                { DROP ;
                                  DUP 2 ;
                                  CDR ;
                                  CAR ;
                                  CAR ;
                                  DUP 2 ;
                                  GET ;
                                  IF_NONE
                                    { DROP ; UNIT }
                                    { PUSH int 0 ;
                                      DUP 2 ;
                                      CDR ;
                                      CAR ;
                                      CDR ;
                                      CDR ;
                                      COMPARE ;
                                      GT ;
                                      PUSH bool True ;
                                      DUP 3 ;
                                      CDR ;
                                      CAR ;
                                      CAR ;
                                      CAR ;
                                      COMPARE ;
                                      EQ ;
                                      AND ;
                                      IF { DUP ;
                                           CDR ;
                                           CAR ;
                                           CDR ;
                                           CAR ;
                                           DUP 2 ;
                                           CDR ;
                                           CDR ;
                                           CAR ;
                                           ADD ;
                                           DUP 4 ;
                                           CAR ;
                                           CAR ;
                                           CAR ;
                                           SENDER ;
                                           GET ;
                                           IF_NONE
                                             { DROP 3 ; UNIT }
                                             { SWAP ;
                                               DUP 2 ;
                                               COMPARE ;
                                               GT ;
                                               IF { PUSH int 0 ;
                                                    PUSH int 1 ;
                                                    DUP 4 ;
                                                    CDR ;
                                                    CAR ;
                                                    CDR ;
                                                    CDR ;
                                                    SUB ;
                                                    COMPARE ;
                                                    EQ ;
                                                    IF { DUP 2 ;
                                                         CDR ;
                                                         CDR ;
                                                         CDR ;
                                                         DUP 3 ;
                                                         CDR ;
                                                         CDR ;
                                                         CAR ;
                                                         PAIR ;
                                                         PUSH int 1 ;
                                                         DUP 4 ;
                                                         CDR ;
                                                         CAR ;
                                                         CDR ;
                                                         CDR ;
                                                         SUB ;
                                                         PUSH mutez 0 ;
                                                         PAIR ;
                                                         DUP 4 ;
                                                         CDR ;
                                                         CAR ;
                                                         CAR ;
                                                         CDR ;
                                                         PUSH bool False ;
                                                         PAIR ;
                                                         PAIR ;
                                                         PAIR ;
                                                         DUP 5 ;
                                                         CDR ;
                                                         CDR ;
                                                         DUP 6 ;
                                                         CDR ;
                                                         CAR ;
                                                         CDR ;
                                                         DUP 7 ;
                                                         CDR ;
                                                         CAR ;
                                                         CAR ;
                                                         DIG 3 ;
                                                         DUP 6 ;
                                                         CAR ;
                                                         PAIR ;
                                                         DIG 6 ;
                                                         SWAP ;
                                                         SOME ;
                                                         SWAP ;
                                                         UPDATE ;
                                                         PAIR ;
                                                         PAIR ;
                                                         DIG 3 ;
                                                         CAR ;
                                                         PAIR ;
                                                         DUP 3 ;
                                                         CDR ;
                                                         CAR ;
                                                         CDR ;
                                                         CAR ;
                                                         DUP 4 ;
                                                         CDR ;
                                                         CDR ;
                                                         CAR ;
                                                         ADD ;
                                                         DIG 2 ;
                                                         SUB_MUTEZ ;
                                                         IF_NONE
                                                           {}
                                                           { DUP 2 ;
                                                             CDR ;
                                                             DUP 3 ;
                                                             CAR ;
                                                             CDR ;
                                                             DUP 4 ;
                                                             CAR ;
                                                             CAR ;
                                                             CDR ;
                                                             DIG 4 ;
                                                             CAR ;
                                                             CAR ;
                                                             CAR ;
                                                             DIG 4 ;
                                                             SENDER ;
                                                             SWAP ;
                                                             SOME ;
                                                             SWAP ;
                                                             UPDATE ;
                                                             PAIR ;
                                                             PAIR ;
                                                             PAIR } ;
                                                         DUP 2 ;
                                                         CDR ;
                                                         CAR ;
                                                         CDR ;
                                                         CAR ;
                                                         DIG 2 ;
                                                         CDR ;
                                                         CDR ;
                                                         CAR ;
                                                         ADD ;
                                                         DUP 2 ;
                                                         CDR ;
                                                         CDR ;
                                                         ADD ;
                                                         DUP 2 ;
                                                         CDR ;
                                                         CAR ;
                                                         PAIR ;
                                                         SWAP ;
                                                         CAR }
                                                       { DUP 2 ;
                                                         CDR ;
                                                         CDR ;
                                                         CDR ;
                                                         DUP 3 ;
                                                         CDR ;
                                                         CDR ;
                                                         CAR ;
                                                         PAIR ;
                                                         PUSH int 1 ;
                                                         DUP 4 ;
                                                         CDR ;
                                                         CAR ;
                                                         CDR ;
                                                         CDR ;
                                                         SUB ;
                                                         PUSH mutez 0 ;
                                                         PAIR ;
                                                         DUP 4 ;
                                                         CDR ;
                                                         CAR ;
                                                         CAR ;
                                                         CDR ;
                                                         PUSH bool True ;
                                                         PAIR ;
                                                         PAIR ;
                                                         PAIR ;
                                                         DUP 5 ;
                                                         CDR ;
                                                         CDR ;
                                                         DUP 6 ;
                                                         CDR ;
                                                         CAR ;
                                                         CDR ;
                                                         DUP 7 ;
                                                         CDR ;
                                                         CAR ;
                                                         CAR ;
                                                         DIG 3 ;
                                                         DUP 6 ;
                                                         CAR ;
                                                         PAIR ;
                                                         DIG 6 ;
                                                         SWAP ;
                                                         SOME ;
                                                         SWAP ;
                                                         UPDATE ;
                                                         PAIR ;
                                                         PAIR ;
                                                         DIG 3 ;
                                                         CAR ;
                                                         PAIR ;
                                                         DUP 3 ;
                                                         CDR ;
                                                         CAR ;
                                                         CDR ;
                                                         CAR ;
                                                         DUP 4 ;
                                                         CDR ;
                                                         CDR ;
                                                         CAR ;
                                                         ADD ;
                                                         DIG 2 ;
                                                         SUB_MUTEZ ;
                                                         IF_NONE
                                                           {}
                                                           { DUP 2 ;
                                                             CDR ;
                                                             DUP 3 ;
                                                             CAR ;
                                                             CDR ;
                                                             DUP 4 ;
                                                             CAR ;
                                                             CAR ;
                                                             CDR ;
                                                             DIG 4 ;
                                                             CAR ;
                                                             CAR ;
                                                             CAR ;
                                                             DIG 4 ;
                                                             SENDER ;
                                                             SWAP ;
                                                             SOME ;
                                                             SWAP ;
                                                             UPDATE ;
                                                             PAIR ;
                                                             PAIR ;
                                                             PAIR } ;
                                                         DUP 2 ;
                                                         CDR ;
                                                         CAR ;
                                                         CDR ;
                                                         CAR ;
                                                         DIG 2 ;
                                                         CDR ;
                                                         CDR ;
                                                         CAR ;
                                                         ADD ;
                                                         DUP 2 ;
                                                         CDR ;
                                                         CDR ;
                                                         ADD ;
                                                         DUP 2 ;
                                                         CDR ;
                                                         CAR ;
                                                         PAIR ;
                                                         SWAP ;
                                                         CAR } ;
                                                    PAIR ;
                                                    UNIT }
                                                  { DROP 3 ; PUSH string "Not enough money in the user wallet" ; FAILWITH } } }
                                         { DROP 2 ; UNIT } } ;
                                  DROP } }
                            { DROP ; PUSH string "You are not admin" ; FAILWITH } } } } }
           { DIG 2 ;
             DROP ;
             IF_LEFT
               { IF_LEFT
                   { DUP 2 ;
                     CDR ;
                     CAR ;
                     CDR ;
                     DUP 2 ;
                     CDR ;
                     GET ;
                     IF_NONE
                       { DROP ; UNIT ; SWAP }
                       { SENDER ;
                         DUP 3 ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { DROP 2 ; UNIT ; SWAP }
                            { SENDER ;
                              SWAP ;
                              CDR ;
                              COMPARE ;
                              EQ ;
                              IF { DUP 2 ;
                                   CDR ;
                                   CAR ;
                                   CDR ;
                                   DUP 2 ;
                                   CDR ;
                                   GET ;
                                   IF_NONE
                                     { DROP ; UNIT ; SWAP }
                                     { UNIT ;
                                       DUP 4 ;
                                       CDR ;
                                       CDR ;
                                       DUP 5 ;
                                       CDR ;
                                       CAR ;
                                       CDR ;
                                       DUP 5 ;
                                       CAR ;
                                       DIG 4 ;
                                       CAR ;
                                       PAIR ;
                                       DIG 4 ;
                                       CDR ;
                                       SWAP ;
                                       SOME ;
                                       SWAP ;
                                       UPDATE ;
                                       DUP 4 ;
                                       CDR ;
                                       CAR ;
                                       CAR ;
                                       PAIR ;
                                       PAIR ;
                                       DIG 2 ;
                                       CAR ;
                                       PAIR } }
                                 { DROP ; UNIT ; SWAP } } } ;
                     SWAP ;
                     DROP }
                   { DUP 2 ;
                     CAR ;
                     CDR ;
                     CDR ;
                     SENDER ;
                     GET ;
                     IF_NONE
                       { DROP ; UNIT }
                       { DUP 2 ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { DUP 2 ;
                              CDR ;
                              CAR ;
                              CAR ;
                              DUP 2 ;
                              CAR ;
                              GET ;
                              IF_NONE
                                { DROP }
                                { DROP ;
                                  DUP ;
                                  CAR ;
                                  DUP 3 ;
                                  CDR ;
                                  CAR ;
                                  CAR ;
                                  DUP 2 ;
                                  GET ;
                                  IF_NONE
                                    { DROP 2 ; UNIT ; SWAP }
                                    { UNIT ;
                                      DUP 5 ;
                                      CDR ;
                                      CDR ;
                                      DUP 6 ;
                                      CDR ;
                                      CAR ;
                                      CDR ;
                                      DUP 7 ;
                                      CDR ;
                                      CAR ;
                                      CAR ;
                                      DIG 6 ;
                                      CDR ;
                                      DIG 5 ;
                                      CAR ;
                                      PAIR ;
                                      DIG 5 ;
                                      SWAP ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      PAIR ;
                                      PAIR ;
                                      DIG 2 ;
                                      CAR ;
                                      PAIR } ;
                                  SWAP ;
                                  DROP } ;
                              UNIT }
                            { DROP ; PUSH string "you are not an agent" ; FAILWITH } } ;
                     DROP } }
               { DUP ;
                 DUP 3 ;
                 CDR ;
                 CDR ;
                 COMPARE ;
                 GT ;
                 DUP 3 ;
                 CAR ;
                 CAR ;
                 CDR ;
                 SENDER ;
                 COMPARE ;
                 EQ ;
                 AND ;
                 IF { SENDER ;
                      CONTRACT unit ;
                      IF_NONE { PUSH string "bad address for get_contract" ; FAILWITH } {} ;
                      DUP 2 ;
                      UNIT ;
                      TRANSFER_TOKENS ;
                      DROP ;
                      DUP 2 ;
                      CDR ;
                      CDR ;
                      SUB_MUTEZ ;
                      IF_NONE
                        { UNIT ; SWAP }
                        { UNIT ; SWAP ; DUP 3 ; CDR ; CAR ; PAIR ; DIG 2 ; CAR ; PAIR } }
                    { DUP 2 ;
                      CAR ;
                      CAR ;
                      CAR ;
                      SENDER ;
                      GET ;
                      IF_NONE
                        { DROP }
                        { DUP 2 ;
                          DUP 2 ;
                          COMPARE ;
                          GT ;
                          IF { SENDER ;
                               CONTRACT unit ;
                               IF_NONE { PUSH string "bad address for get_contract" ; FAILWITH } {} ;
                               DUP 3 ;
                               UNIT ;
                               TRANSFER_TOKENS ;
                               DROP ;
                               SUB_MUTEZ ;
                               IF_NONE
                                 {}
                                 { DUP 2 ;
                                   CDR ;
                                   DUP 3 ;
                                   CAR ;
                                   CDR ;
                                   DUP 4 ;
                                   CAR ;
                                   CAR ;
                                   CDR ;
                                   DIG 4 ;
                                   CAR ;
                                   CAR ;
                                   CAR ;
                                   DIG 4 ;
                                   SENDER ;
                                   SWAP ;
                                   SOME ;
                                   SWAP ;
                                   UPDATE ;
                                   PAIR ;
                                   PAIR ;
                                   PAIR } }
                             { DROP 2 } } ;
                      UNIT ;
                      SWAP } ;
                 SWAP ;
                 DROP } } ;
         NIL operation ;
         PAIR } }
